<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A focused study timer with session tracking and progress visualization">
    <meta name="theme-color" content="#0f0f0f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Studo">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBkPSJNMTIgMkM2LjQ4IDIgMiA2LjQ4IDIgMTJzNC40OCAxMCAxMCAxMCAxMC00LjQ4IDEwLTEwUzE3LjUyIDIgMTIgMnptMCAxOGMtNC40MSAwLTgtMy41OS04LTggczMuNTktOCA4LTggOCAzLjU5IDggOC0zLjU5IDgtOCA4eiIgZmlsbD0iI2ZmZmZmZiIvPgo8cGF0aCBkPSJNMTIgNkM5Ljc5IDYgOCA3Ljc5IDggMTBzMS43OSA0IDQgNCA0LTEuNzkgNC00LTEuNzktNC00LTR6bTAgNmMtMS4xIDAtMi0uOS0yLTIgcy45LTIgMi0yIDIgLjkgMiAyLS45IDItMiAyeiIgZmlsbD0iI2ZmZmZmZiIvPgo8L3N2Zz4K">
    <title>Studo - Study Timer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Kirang+Haerang&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Loading screen while checking authentication -->
    <div id="authLoadingScreen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0f0f0f; display: flex; justify-content: center; align-items: center; z-index: 10000;">
        <div style="text-align: center; color: white; font-family: 'IBM Plex Mono', monospace;">
            <div style="font-size: 2rem; margin-bottom: 20px;">üîê</div>
            <div style="font-size: 1.2rem; margin-bottom: 10px;">Checking Authentication...</div>
            <div style="font-size: 0.9rem; color: #888;">Please wait while we verify your login</div>
        </div>
    </div>

    <!-- Main content (hidden until authentication is verified) -->
    <div id="mainContent" style="display: none;">
        <!-- Main Timer Interface -->
    <div class="container">
        <div class="main-timer-section" style="text-align: center; margin-bottom: 50px;">
            <div class="timer-controls">
                <button id="analyticsBtn" class="control-btn" title="Analytics (L)">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <path fill="white" fill-rule="evenodd" d="M3 6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6zm10 2a1 1 0 1 0-2 0v8a1 1 0 1 0 2 0V8zm-4 3a1 1 0 1 0-2 0v5a1 1 0 1 0 2 0v-5zm8 3a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2z" clip-rule="evenodd"></path>
                        </g>
                    </svg>
                </button>
                <button id="logBtn" class="control-btn" title="Study Session Log (M)">
                    <svg id="logIcon" class="log-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <g fill="none">
                            <path d="M24 0v24H0V0h24ZM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035c-.01-.004-.019-.001-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427c-.002-.01-.009-.017-.017-.018Zm.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093c.012.004.023 0 .029-.008l.004-.014l-.034-.614c-.003-.012-.01-.02-.02-.022Zm-.715.002a.023.023 0 0 0-.027.006l-.006.014l-.034.614c0 .012.007.02.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01l-.184-.092Z"/>
                            <path fill="white" d="M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h11a3 3 0 0 0 3-3V5a3 3 0 0 0-3-3h-1v9.793a.5.5 0 0 1-.854.353l-1.792-1.792a.5.5 0 0 0-.708 0l-1.792 1.792a.5.5 0 0 1-.854-.353V2H6Z"/>
                        </g>
                    </svg>
                    <!-- Grid/heatmap icon (shown when log is visible) -->
                    <svg id="gridIcon" class="grid-icon" viewBox="0 -0.5 21 21" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#ffffff" width="24" height="24" style="display: none;">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier"> 
                            <title>grid [#1526]</title>
                            <desc>Created with Sketch.</desc>
                            <defs> </defs>
                            <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> 
                                <g id="Dribbble-Light-Preview" transform="translate(-219.000000, -200.000000)" fill="#ffffff"> 
                                    <g id="icons" transform="translate(56.000000, 160.000000)"> 
                                        <path d="M181.9,54 L179.8,54 C178.63975,54 177.7,54.895 177.7,56 L177.7,58 C177.7,59.105 178.63975,60 179.8,60 L181.9,60 C183.06025,60 184,59.105 184,58 L184,56 C184,54.895 183.06025,54 181.9,54 M174.55,54 L172.45,54 C171.28975,54 170.35,54.895 170.35,56 L170.35,58 C170.35,59.105 171.28975,60 172.45,60 L174.55,60 C175.71025,60 176.65,59.105 176.65,58 L176.65,56 C176.65,54.895 175.71025,54 174.55,54 M167.2,54 L165.1,54 C163.93975,54 163,54.895 163,56 L163,58 C163,59.105 163.93975,60 165.1,60 L167.2,60 C168.36025,60 169.3,59.105 169.3,58 L169.3,56 C169.3,54.895 168.36025,54 167.2,54 M181.9,47 L179.8,47 C178.63975,47 177.7,47.895 177.7,49 L177.7,51 C177.7,52.105 178.63975,53 179.8,53 L181.9,53 C183.06025,53 184,52.105 184,51 L184,49 C184,47.895 183.06025,47 181.9,47 M174.55,47 L172.45,47 C171.28975,47 170.35,47.895 170.35,49 L170.35,51 C170.35,52.105 171.28975,53 172.45,53 L174.55,53 C175.71025,53 176.65,52.105 176.65,51 L176.65,49 C176.65,47.895 175.71025,47 174.55,47 M167.2,47 L165.1,47 C163.93975,47 163,47.895 163,49 L163,51 C163,52.105 163.93975,53 165.1,53 L167.2,53 C168.36025,53 169.3,52.105 169.3,51 L169.3,49 C169.3,47.895 168.36025,47 167.2,47 M181.9,40 L179.8,40 C178.63975,40 177.7,40.895 177.7,42 L177.7,44 C177.7,45.105 178.63975,46 179.8,46 L181.9,46 C183.06025,46 184,45.105 184,44 L184,42 C184,40.895 183.06025,40 181.9,40 M174.55,40 L172.45,40 C171.28975,40 170.35,40.895 170.35,42 L170.35,44 C170.35,45.105 171.28975,46 172.45,46 L174.55,46 C175.71025,46 176.65,45.105 176.65,44 L176.65,42 C176.65,40.895 175.71025,40 174.55,40 M169.3,42 L169.3,44 C169.3,45.105 168.36025,46 167.2,46 L165.1,46 C163.93975,46 163,45.105 163,44 L163,42 C163,40.895 163.93975,40 165.1,40 L167.2,40 C168.36025,40 169.3,40.895 169.3,42" id="grid-[#1526]"> </path> 
                                    </g> 
                                </g> 
                            </g>
                        </g>
                    </svg>
                </button>
                <button id="playBtn" class="control-btn" title="Start Timer (Enter/S)">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 5V19L19 12L8 5Z" fill="white"/>
                    </svg>
                </button>
                <div id="timer" class="timer" title="Click to switch modes">25:00</div>
                <button id="pauseBtn" class="control-btn" title="Pause/Resume (P)">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 4H10V20H6V4ZM14 4H18V20H14V4Z" fill="white"/>
                    </svg>
                </button>
                <button id="accountBtn" class="control-btn" title="Account Settings (A)">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <path d="M6.25 7a5.75 5.75 0 1 1 11.5 0 5.75 5.75 0 0 1-11.5 0ZM11.797 14.261a.755.755 0 0 1 .13-.011h.144c.044 0 .088.004.131.011l7.295 1.283a.64.64 0 0 1 .038.008c1.343.31 2.787 1.163 3.068 2.82a.73.73 0 0 1 .005.029l.113.877v.002c.265 2.009-1.328 3.47-3.21 3.47a.753.753 0 0 1-.123-.01h-14.9c-1.882 0-3.475-1.462-3.21-3.472l.114-.869a.753.753 0 0 1 .005-.03c.28-1.627 1.735-2.528 3.077-2.819a.719.719 0 0 1 .029-.006l7.294-1.283Z" fill="white"/>
                        </g>
                    </svg>
                </button>
                <button id="settingsBtn" class="control-btn" title="Settings (Q)">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="24" height="24">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M20 9c1.66 0 3 1.34 3 3s-1.34 3-3 3h-.76l.54.54a3 3 0 0 1 0 4.24 3 3 0 0 1-4.24 0l-.54-.54V20c0 1.66-1.34 3-3 3s-3-1.34-3-3v-.76l-.54.54a3 3 0 0 1-4.24 0 3 3 0 0 1 0-4.24l.54-.54H4c-1.66 0-3-1.34-3-3s1.34-3 3-3h.76l-.54-.54a3 3 0 0 1 0-4.24 3 3 0 0 1 4.24 0l.54.54V4c0-1.66 1.34-3 3-3s3 1.34 3 3v.76l.54-.54a3 3 0 0 1 4.24 0 3 3 0 0 1 0 4.24l-.54-.54H20Zm-4 3a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z" fill="white"/>
                        </g>
                    </svg>
                </button>
            </div>
            <div class="progress-bar"></div>
            
            <div id="heatmap" class="heatmap-container">
                <p style="color: #666; font-size: 14px; font-family: 'IBM Plex Mono', monospace;">Study sessions will be tracked here</p>
            </div>
            
            <!-- Study Method Buttons -->
            <div class="blurting-section" style="text-align: center; margin-top: 30px;">
                <button id="blurtingBtn" class="blurting-btn" title="Blurting Method - Create A4 Notes">
                    <svg viewBox="-3 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" fill="#ffffff" width="24" height="24">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier"> 
                            <title>text-document</title>
                            <desc>Created with Sketch Beta.</desc>
                            <defs> </defs>
                            <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage"> 
                                <g id="Icon-Set-Filled" sketch:type="MSLayerGroup" transform="translate(-105.000000, -101.000000)" fill="#ffffff"> 
                                    <path d="M125,109 C123.896,109 123,108.104 123,107 L123,103 L129,109 L125,109 L125,109 Z M124,119 L112,119 C111.448,119 111,118.553 111,118 C111,117.448 111.448,117 112,117 L124,117 C124.552,117 125,117.448 125,118 C125,118.553 124.552,119 124,119 L124,119 Z M124,125 L112,125 C111.448,125 111,124.553 111,124 C111,123.447 111.448,123 112,123 L124,123 C124.552,123 125,123.447 125,124 C125,124.553 124.552,125 124,125 L124,125 Z M123,101.028 C122.872,101.028 109,101 109,101 C106.791,101 105,102.791 105,105 L105,129 C105,131.209 106.791,133 109,133 L127,133 C129.209,133 131,131.209 131,129 L131,109 L123,101.028 L123,101.028 Z" id="text-document" sketch:type="MSShapeGroup"> </path> 
                                </g> 
                            </g>
                        </g>
                    </svg>
                    <span class="tooltip">Blurting</span>
                </button>
                
                <button id="goalSettingBtn" class="blurting-btn" title="Goal Setting - Set and Track Your Study Goals">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" width="24" height="24">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier"> 
                            <g> 
                                <path fill="none" d="M0 0h24v24H0z"></path> 
                                <path d="M12 2c5.52 0 10 4.48 10 10s-4.48 10-10 10S2 17.52 2 12 6.48 2 12 2zm0 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" fill="white"></path> 
                            </g> 
                        </g>
                    </svg>
                    <span class="tooltip">Goal Setting</span>
                </button>
                
                <button id="activeRecallBtn" class="blurting-btn" title="Active Recall - Test Your Knowledge">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="24" height="24">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M6 6c0-1.4 0-2.1.272-2.635a2.5 2.5 0 0 1 1.093-1.093C7.9 2 8.6 2 10 2h4c1.4 0 2.1 0 2.635.272a2.5 2.5 0 0 1 1.092 1.093C18 3.9 18 4.6 18 6v12c0 1.4 0 2.1-.273 2.635a2.5 2.5 0 0 1-1.092 1.092C16.1 22 15.4 22 14 22h-4c-1.4 0-2.1 0-2.635-.273a2.5 2.5 0 0 1-1.093-1.092C6 20.1 6 19.4 6 18V6zm14 0a1 1 0 1 1 2 0v12a1 1 0 1 1-2 0V6zM3 5a1 1 0 0 0-1 1v12a1 1 0 1 0 2 0V6a1 1 0 0 0-1-1z" fill="white"/>
                        </g>
                    </svg>
                    <span class="tooltip">Active Recall</span>
                </button>
                

            </div>
                

        </div>
        

        
        <div id="logContainer" class="log-container" style="display: none;">
            <div class="log-header">
                <h3 style="margin: 0; font-family: 'IBM Plex Mono', monospace; color: white;">Study Session Log</h3>
                <div class="log-filters">
                    <select id="logTimeFilter" style="font-family: 'IBM Plex Mono', monospace; padding: 6px; border-radius: 4px; border: 1px solid #666; background: #333; color: white; font-size: 12px;">
                        <option value="all">All Time</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                        <option value="year">This Year</option>
                    </select>
                    <select id="logSortBy" style="font-family: 'IBM Plex Mono', monospace; padding: 6px; border-radius: 4px; border: 1px solid #666; background: #333; color: white; font-size: 12px;">
                        <option value="date-desc">Newest First</option>
                        <option value="date-asc">Oldest First</option>
                        <option value="duration-desc">Longest First</option>
                        <option value="duration-asc">Shortest First</option>
                    </select>
                </div>
            </div>
            <div id="logContent" class="log-content">
                <!-- Log entries will be populated here -->
            </div>
        </div>
        

    </div>
        

    
    <!-- Settings Modal -->
    <div id="settingsModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="margin: 0; font-family: 'IBM Plex Mono', monospace; color: white;">Settings</h3>
                <button id="closeSettings" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label for="timerMode" style="font-family: 'IBM Plex Mono', monospace; color: white; display: block; margin-bottom: 10px;">Timer Mode:</label>
                    <select id="timerMode" style="font-family: 'IBM Plex Mono', monospace; padding: 8px; border-radius: 4px; border: 1px solid #666; background: #333; color: white; width: 100%;">
                        <option value="timer">Focus Timer</option>
                        <option value="stopwatch">Stopwatch</option>
                            <option value="pomodoro">Pomodoro Technique</option>
                    </select>
                </div>
                
                <div class="setting-group" id="focusTimeGroup">
                    <label for="focusMinutes" style="font-family: 'IBM Plex Mono', monospace; color: white; display: block; margin-bottom: 10px;">Focus Timer Duration:</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div style="flex: 1;">
                            <label for="focusMinutes" style="font-family: 'IBM Plex Mono', monospace; color: #ccc; font-size: 12px; display: block; margin-bottom: 5px;">Minutes:</label>
                            <input type="number" id="focusMinutes" min="0" max="1440" value="25" style="font-family: 'IBM Plex Mono', monospace; padding: 8px; border-radius: 4px; border: 1px solid #666; background: #333; color: white; width: 100%;">
                        </div>
                        <div style="flex: 1;">
                            <label for="focusSeconds" style="font-family: 'IBM Plex Mono', monospace; color: #ccc; font-size: 12px; display: block; margin-bottom: 5px;">Seconds:</label>
                            <input type="number" id="focusSeconds" min="0" max="59" value="0" style="font-family: 'IBM Plex Mono', monospace; padding: 8px; border-radius: 4px; border: 1px solid #666; background: #333; color: white; width: 100%;">
                        </div>
                    </div>
                </div>
                    
                    <div class="setting-group" id="pomodoroGroup" style="display: none;">
                        <label style="font-family: 'IBM Plex Mono', monospace; color: white; display: block; margin-bottom: 10px;">Pomodoro Settings:</label>
                        <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px;">
                            <div style="flex: 1;">
                                <label for="pomodoroStudyMinutes" style="font-family: 'IBM Plex Mono', monospace; color: #ccc; font-size: 12px; display: block; margin-bottom: 5px;">Study Time (min):</label>
                                <input type="number" id="pomodoroStudyMinutes" min="1" max="120" value="25" style="font-family: 'IBM Plex Mono', monospace; padding: 8px; border-radius: 4px; border: 1px solid #666; background: #333; color: white; width: 100%;">
                            </div>
                            <div style="flex: 1;">
                                <label for="pomodoroBreakMinutes" style="font-family: 'IBM Plex Mono', monospace; color: #ccc; font-size: 12px; display: block; margin-bottom: 5px;">Break Time (min):</label>
                                <input type="number" id="pomodoroBreakMinutes" min="1" max="60" value="5" style="font-family: 'IBM Plex Mono', monospace; padding: 8px; border-radius: 4px; border: 1px solid #666; background: #333; color: white; width: 100%;">
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px;">
                            <div style="flex: 1;">
                                <label for="pomodoroLongBreakMinutes" style="font-family: 'IBM Plex Mono', monospace; color: #ccc; font-size: 12px; display: block; margin-bottom: 5px;">Long Break (min):</label>
                                <input type="number" id="pomodoroLongBreakMinutes" min="5" max="120" value="15" style="font-family: 'IBM Plex Mono', monospace; padding: 8px; border-radius: 4px; border: 1px solid #666; background: #333; color: white; width: 100%;">
                            </div>
                            <div style="flex: 1;">
                                <label for="pomodoroSessionsBeforeLongBreak" style="font-family: 'IBM Plex Mono', monospace; color: #ccc; font-size: 12px; display: block; margin-bottom: 5px;">Sessions before Long Break:</label>
                                <input type="number" id="pomodoroSessionsBeforeLongBreak" min="1" max="10" value="4" style="font-family: 'IBM Plex Mono', monospace; padding: 8px; border-radius: 4px; border: 1px solid #666; background: #333; color: white; width: 100%;">
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                        </div>
                    </div>
                
                <div class="setting-group">
                    <button id="saveSettings" style="font-family: 'IBM Plex Mono', monospace; padding: 10px 20px; background: #666; color: white; border: none; border-radius: 4px; cursor: pointer; width: 100%; margin-top: 20px;">Save Settings</button>
                </div>
                
                <div class="setting-group" id="installAppGroup" style="display: none;">
                    <label style="font-family: 'IBM Plex Mono', monospace; color: white; display: block; margin-bottom: 10px;">Install App:</label>
                    <button id="installAppBtn" style="font-family: 'IBM Plex Mono', monospace; padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; width: 100%;">
                        üì± Install Studo App
                    </button>
                    <p style="font-family: 'IBM Plex Mono', monospace; color: #ccc; font-size: 12px; margin-top: 8px; text-align: center;">
                        Install for offline use and quick access
                    </p>
                    <p id="localhostNotice" style="font-family: 'IBM Plex Mono', monospace; color: #ff6b6b; font-size: 11px; margin-top: 8px; text-align: center; display: none;">
                        ‚ö†Ô∏è PWA features disabled on localhost
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Edit Session Modal -->
    <div id="editSessionModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="margin: 0; font-family: 'IBM Plex Mono', monospace; color: white;">Edit Study Session</h3>
                <button id="closeEditSession" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label for="editSessionDate" style="font-family: 'IBM Plex Mono', monospace; color: white; display: block; margin-bottom: 10px;">Date:</label>
                    <input type="date" id="editSessionDate" style="font-family: 'IBM Plex Mono', monospace; padding: 8px; border-radius: 4px; border: 1px solid #666; background: #333; color: white; width: 100%;">
                </div>
                

                
                <div class="setting-group">
                    <label for="editSessionDescription" style="font-family: 'IBM Plex Mono', monospace; color: white; display: block; margin-bottom: 10px;">Description:</label>
                    <textarea id="editSessionDescription" placeholder="What did you study?" rows="3" style="font-family: 'IBM Plex Mono', monospace; padding: 8px; border-radius: 4px; border: 1px solid #666; background: #333; color: white; width: 100%; resize: vertical;"></textarea>
                </div>
                
                <div class="setting-group">
                    <label for="editSessionImage" style="font-family: 'IBM Plex Mono', monospace; color: white; display: block; margin-bottom: 10px;">Image URL (optional):</label>
                    <input type="url" id="editSessionImage" placeholder="https://example.com/image.jpg" style="font-family: 'IBM Plex Mono', monospace; padding: 8px; border-radius: 4px; border: 1px solid #666; background: #333; color: white; width: 100%;">
                </div>
                
                <div class="setting-group">
                    <label for="editSessionNotes" style="font-family: 'IBM Plex Mono', monospace; color: white; display: block; margin-bottom: 10px;">Notes:</label>
                    <textarea id="editSessionNotes" placeholder="Additional notes, formulas, key points..." rows="4" style="font-family: 'IBM Plex Mono', monospace; padding: 8px; border-radius: 4px; border: 1px solid #666; background: #333; color: white; width: 100%; resize: vertical;"></textarea>
                </div>
                
                <div class="setting-group">
                    <button id="saveEditSession" style="font-family: 'IBM Plex Mono', monospace; padding: 10px 20px; background: #666; color: white; border: none; border-radius: 4px; cursor: pointer; width: 100%; margin-top: 20px;">Save Changes</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Account Modal -->
    <div id="accountModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="margin: 0; font-family: 'IBM Plex Mono', monospace; color: white;">Account Settings</h3>
                <button id="closeAccount" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label style="font-family: 'IBM Plex Mono', monospace; color: white; display: block; margin-bottom: 10px;">Email/Username:</label>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <input type="text" id="accountUsername" readonly style="font-family: 'IBM Plex Mono', monospace; padding: 8px; border-radius: 4px; border: 1px solid #666; background: #222; color: #ccc; width: 100%; cursor: text;" value="Loading...">
                        <button id="copyUsername" class="copy-btn" title="Copy to clipboard" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 4px; padding: 8px; cursor: pointer; color: white; font-size: 12px; min-width: 60px;">Copy</button>
                    </div>
                </div>
                
                <div class="setting-group">
                        <p style="color: #888; font-size: 12px; margin-top: 15px; text-align: justify; font-family: 'IBM Plex Mono', monospace;">
                        Your credentials are displayed for reference only. Use the copy buttons to copy them to your clipboard.
                    </p>
                </div>
                
                <div class="setting-group" style="margin-top: 30px; border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 20px;">
                     
                        <div class="account-actions-buttons">
                            <button id="logoutBtn" class="logout-btn">Logout</button>
                            <button id="deleteAccountBtn" class="delete-account-btn">Remove All Data</button>
                        </div>
                    </div>
  
                    </div>
            </div>
        </div>
    </div>
    
    <!-- Analytics Modal -->
    <div id="analyticsModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="margin: 0; font-family: 'IBM Plex Mono', monospace; color: white;">Study Analytics</h3>
                <button id="closeAnalytics" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <h4 style="color: white; margin-bottom: 15px;">Study Statistics</h4>
                    <div id="analyticsContent" style="color: #ccc; font-family: 'IBM Plex Mono', monospace; font-size: 14px;">
                        <p>Loading analytics...</p>
                    </div>
                    
                    <!-- Basic Analytics Side by Side -->
                    <div class="basic-analytics-side-by-side" style="margin-top: 20px;">
                        <!-- Weekly Activity -->
                        <div class="analytics-text-column">
                            <h5 style="color: white; margin-bottom: 10px;">Weekly Activity</h5>
                            <div id="weeklyActivityBasic" style="color: #ccc; font-family: 'IBM Plex Mono', monospace; font-size: 14px;">
                                <p>Loading weekly data...</p>
                            </div>
                        </div>
                        
                        <!-- Most Active -->
                        <div class="analytics-text-column">
                            <h5 style="color: white; margin-bottom: 10px;">Most Active</h5>
                            <div id="mostActiveBasic" style="color: #ccc; font-family: 'IBM Plex Mono', monospace; font-size: 14px;">
                                <p>Loading activity data...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 25px;">
                        <button id="toggleDetailedAnalyticsBtn" class="toggle-analytics-btn">
                            <span class="toggle-text">Show Detailed Charts</span>
                        </button>
                    </div>
                    
                    <!-- Detailed Analytics Charts Section -->
                    <div id="detailedAnalyticsSection" style="display: none; margin-top: 30px;">
                        <!-- Study Statistics Overview -->
                        <div class="chart-container full-width">
                            <h3>üìà Study Statistics Overview</h3>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <h4>Total Sessions</h4>
                                    <div class="value" id="totalSessions">Loading...</div>
                                </div>
                                <div class="stat-card">
                                    <h4>Total Study Time</h4>
                                    <div class="value" id="totalStudyTime">Loading...</div>
                                </div>
                                <div class="stat-card">
                                    <h4>Average Session</h4>
                                    <div class="value" id="averageSession">Loading...</div>
                                </div>
                                <div class="stat-card">
                                    <h4>Current Streak</h4>
                                    <div class="value" id="currentStreak">Loading...</div>
                                </div>
                            </div>
                        </div>

                        <div class="analytics-grid">
                            <!-- Time Distribution Chart -->
                            <div class="chart-container half-width">
                                <h3>‚è∞ Study Time Distribution</h3>
                                <canvas id="timeDistributionChart" width="400" height="200"></canvas>
                            </div>

                            <!-- Weekly Activity Chart -->
                            <div class="chart-container half-width">
                                <h3>üìÖ Weekly Study Activity</h3>
                                <canvas id="weeklyActivityChart" width="400" height="200"></canvas>
                            </div>

                            <!-- Session Length Distribution -->
                            <div class="chart-container half-width">
                                <h3>‚è±Ô∏è Session Length Distribution</h3>
                                <canvas id="sessionLengthChart" width="400" height="200"></canvas>
                            </div>

                            <!-- Monthly Progress -->
                            <div class="chart-container half-width">
                                <h3>üìà Monthly Study Progress</h3>
                                <canvas id="monthlyProgressChart" width="400" height="200"></canvas>
                            </div>

                            <!-- Study Streaks -->
                            <div class="chart-container half-width">
                                <h3>üî• Study Streaks</h3>
                                <div id="streaksContent" style="color: #ccc; font-family: 'IBM Plex Mono', monospace; font-size: 14px;">
                                    <p>Loading streaks data...</p>
                                </div>
                            </div>

                            <!-- Top Study Days -->
                            <div class="chart-container half-width">
                                <h3>üèÜ Top Study Days</h3>
                                <div id="topDaysContent" style="color: #ccc; font-family: 'IBM Plex Mono', monospace; font-size: 14px;">
                                    <p>Loading top days data...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    

    
    <!-- Chart.js for analytics -->
        <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
        <script src="supabase-config.js"></script>
        <script>
            // Initialize Supabase session first
            async function checkAuthentication() {
                console.log('üîê Checking authentication...');
                
                // Check if account was deleted
                const accountDeleted = localStorage.getItem('accountDeleted') === 'true';
                if (accountDeleted) {
                    console.log('‚ùå Account was deleted, redirecting to login');
                    handleUnauthorizedAccess('Account was deleted');
                    return;
                }
                
                // Check localStorage data
                const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                const userEmail = localStorage.getItem('userEmail');
                const userId = localStorage.getItem('userId');
                
                if (!isLoggedIn || !userEmail || !userId) {
                    console.log('‚ùå No login data found in localStorage');
                    handleUnauthorizedAccess('No login data found');
                    return;
                }
                
                // Validate data format
                if (!validateAuthData(userEmail, userId)) {
                    console.log('‚ùå Invalid auth data format');
                    handleUnauthorizedAccess('Invalid authentication data');
                    return;
                }
                
                try {
                    // Try to get current Supabase session
                    if (window.SupabaseService && window.SupabaseService.supabase) {
                        console.log('üîç Checking Supabase session...');
                        
                        // Try to initialize session
                        await window.SupabaseService.initializeSession();
                        
                        // Get current session
                        const session = await window.SupabaseService.getCurrentSession();
                        const user = await window.SupabaseService.getCurrentUser();
                        
                        if (session && user) {
                            console.log('‚úÖ Valid Supabase session found');
                            showMainContent();
                            return;
                        } else {
                            console.log('‚ö†Ô∏è No valid Supabase session, trying to refresh...');
                            
                            // Try to refresh session
                            const refreshed = await window.SupabaseService.refreshSession();
                            if (refreshed) {
                                console.log('‚úÖ Session refreshed successfully');
                                showMainContent();
                                return;
                            }
                            
                            // Try to recover from storage
                            const recovered = window.SupabaseService.recoverSessionFromStorage();
                            if (recovered) {
                                console.log('‚úÖ Session recovered from storage');
                                showMainContent();
                                return;
                            }
                        }
                    }
                    
                    // Fallback: use localStorage data if Supabase is not available
                    console.log('‚ö†Ô∏è Using localStorage fallback');
                    showMainContent();
                    
                } catch (error) {
                    console.error('‚ùå Authentication check failed:', error);
                    
                    // Try to recover from storage
                    if (window.SupabaseService && window.SupabaseService.recoverSessionFromStorage) {
                        const recovered = window.SupabaseService.recoverSessionFromStorage();
                        if (recovered) {
                            console.log('‚úÖ Session recovered after error');
                            showMainContent();
                            return;
                        }
                    }
                    
                    handleUnauthorizedAccess('Authentication check failed');
                }
            }
            
            function showMainContent() {
                console.log('‚úÖ Showing main content');
                document.getElementById('authLoadingScreen').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                
                // Display user email
                const userEmail = localStorage.getItem('userEmail');
                if (userEmail) {
                    const emailDisplay = document.getElementById('userEmailDisplay');
                    if (emailDisplay) {
                        emailDisplay.textContent = userEmail;
                    }
                }
            }
            
            function validateAuthData(email, userId) {
                // Basic validation
                if (!email || typeof email !== 'string' || email.length < 3) return false;
                if (!userId || typeof userId !== 'string' || userId.length < 10) return false;
                
                // Check if email format is reasonable
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) return false;
                
                return true;
            }
            
            function handleUnauthorizedAccess(reason) {
                console.log('üö´ Unauthorized access:', reason);
                alert(`Access denied: ${reason}\nPlease log in again.`);
                localStorage.clear();
                sessionStorage.clear();
                window.location.href = 'login.html';
            }
            
            // Timer mode change handler for Pomodoro functionality
            function handleTimerModeChange() {
                const timerMode = document.getElementById('timerMode').value;
                const focusTimeGroup = document.getElementById('focusTimeGroup');
                const pomodoroGroup = document.getElementById('pomodoroGroup');
                
                // Hide all groups first
                focusTimeGroup.style.display = 'none';
                pomodoroGroup.style.display = 'none';
                
                // Show appropriate group based on selection
                if (timerMode === 'timer') {
                    focusTimeGroup.style.display = 'block';
                } else if (timerMode === 'pomodoro') {
                    pomodoroGroup.style.display = 'block';
                }
                // stopwatch mode shows no additional settings
            }
            
            // Save settings including Pomodoro settings
            function saveSettings() {
                const timerMode = document.getElementById('timerMode').value;
                const settings = {
                    timerMode: timerMode
                };
                
                if (timerMode === 'timer') {
                    settings.focusMinutes = parseInt(document.getElementById('focusMinutes').value) || 25;
                    settings.focusSeconds = parseInt(document.getElementById('focusSeconds').value) || 0;
                } else if (timerMode === 'pomodoro') {
                    settings.pomodoroStudyMinutes = parseInt(document.getElementById('pomodoroStudyMinutes').value) || 25;
                    settings.pomodoroBreakMinutes = parseInt(document.getElementById('pomodoroBreakMinutes').value) || 5;
                    settings.pomodoroLongBreakMinutes = parseInt(document.getElementById('pomodoroLongBreakMinutes').value) || 15;
                    settings.pomodoroSessionsBeforeLongBreak = parseInt(document.getElementById('pomodoroSessionsBeforeLongBreak').value) || 4;
                }
                
                // Save to localStorage
                localStorage.setItem('timerSettings', JSON.stringify(settings));
                
                // Save to Supabase if available
                if (window.SupabaseService && window.SupabaseService.timerSettings) {
                    window.SupabaseService.timerSettings.saveSettings(settings);
                }
                
                console.log('‚úÖ Settings saved:', settings);
                alert('Settings saved successfully!');
            }
            
            // Load settings including Pomodoro settings
            function loadSettings() {
                try {
                    // Load from localStorage
                    const savedSettings = localStorage.getItem('timerSettings');
                    if (savedSettings) {
                        const settings = JSON.parse(savedSettings);
                        
                        // Set timer mode
                        document.getElementById('timerMode').value = settings.timerMode || 'timer';
                        
                        // Set focus timer settings
                        if (settings.focusMinutes !== undefined) {
                            document.getElementById('focusMinutes').value = settings.focusMinutes;
                        }
                        if (settings.focusSeconds !== undefined) {
                            document.getElementById('focusSeconds').value = settings.focusSeconds;
                        }
                        
                        // Set Pomodoro settings
                        if (settings.pomodoroStudyMinutes !== undefined) {
                            document.getElementById('pomodoroStudyMinutes').value = settings.pomodoroStudyMinutes;
                        }
                        if (settings.pomodoroBreakMinutes !== undefined) {
                            document.getElementById('pomodoroBreakMinutes').value = settings.pomodoroBreakMinutes;
                        }
                        if (settings.pomodoroLongBreakMinutes !== undefined) {
                            document.getElementById('pomodoroLongBreakMinutes').value = settings.pomodoroLongBreakMinutes;
                        }
                        if (settings.pomodoroSessionsBeforeLongBreak !== undefined) {
                            document.getElementById('pomodoroSessionsBeforeLongBreak').value = settings.pomodoroSessionsBeforeLongBreak;
                        }
                        
                        // Show appropriate settings group
                        handleTimerModeChange();
                        
                        console.log('‚úÖ Settings loaded:', settings);
                    }
                } catch (error) {
                    console.error('‚ùå Error loading settings:', error);
                }
            }
            
            // Initialize settings when DOM is loaded
            document.addEventListener('DOMContentLoaded', function() {
                // Load settings
                loadSettings();
                
                // Add event listeners
                document.getElementById('timerMode').addEventListener('change', handleTimerModeChange);
                document.getElementById('saveSettings').addEventListener('click', saveSettings);
                
                // Initialize timer mode display
                handleTimerModeChange();
            });
            
            // Run authentication check
            checkAuthentication();
            
            // Set up periodic authentication checks (every 5 minutes)
            setInterval(() => {
                console.log('üîÑ Periodic authentication check...');
                if (window.SupabaseService && window.SupabaseService.auth) {
                    // Check if we still have a valid session
                    const cachedUser = window.SupabaseService.auth.getCachedUser();
                    const cachedSession = window.SupabaseService.auth.getCachedSession();
                    
                    if (!cachedUser || !cachedSession) {
                        console.log('‚ö†Ô∏è Session appears to have expired, checking authentication...');
                        checkAuthentication();
                    } else {
                        console.log('‚úÖ Periodic check: Session still valid');
                    }
                }
            }, 5 * 60 * 1000); // 5 minutes
            
            // Also check authentication when the page becomes visible (user returns to tab)
            document.addEventListener('visibilitychange', () => {
                if (!document.hidden) {
                    console.log('üëÅÔ∏è Page became visible, checking authentication...');
                    checkAuthentication();
                }
            });
            
            // Display user email
            const userEmail = localStorage.getItem('userEmail') || 'User';
            document.addEventListener('DOMContentLoaded', function() {
                const usernameDisplay = document.getElementById('usernameDisplay');
                if (usernameDisplay) {
                    usernameDisplay.textContent = `Welcome, ${userEmail}`;
                }
            });
            
            // Logout function
            async function logout() {
                try {
                    console.log('üö™ Logging out user...');
                    
                    // Sign out from Supabase
                    if (window.SupabaseService && window.SupabaseService.auth) {
                        await window.SupabaseService.auth.signOut();
                    }
                    
                    // Clear local storage
                    localStorage.removeItem('isLoggedIn');
                    localStorage.removeItem('userEmail');
                    localStorage.removeItem('userId');
                    
                    // Clear any other authentication-related data
                    localStorage.removeItem('studyData');
                    sessionStorage.clear();
                    
                    console.log('‚úÖ Logout successful, redirecting to login');
                    
                    // Redirect to login
                    window.location.href = 'login.html';
                } catch (error) {
                    console.error('‚ùå Logout error:', error);
                    // Force redirect even if Supabase logout fails
                    localStorage.clear();
                    window.location.href = 'login.html';
                }
            }
            
            // Function to force logout and redirect (for security purposes)
            function forceLogout(reason = 'Security check failed') {
                console.log(`üö® Force logout: ${reason}`);
                localStorage.clear();
                sessionStorage.clear();
                window.location.href = 'login.html';
            }
            
            // Add logout button event listener when DOM is loaded
            document.addEventListener('DOMContentLoaded', function() {
                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', logout);
                }
                
                // Additional security check - ensure user can't access the page directly
                // without proper authentication flow
                const currentPath = window.location.pathname;
                const referrer = document.referrer;
                
                // If user accessed the page directly (not from login), verify authentication
                if (!referrer || !referrer.includes('login.html')) {
                    console.log('üîí Direct page access detected, verifying authentication...');
                    
                    // Double-check authentication
                    setTimeout(() => {
                        if (window.SupabaseService && window.SupabaseService.auth) {
                            const isAuthenticated = window.SupabaseService.auth.isAuthenticated();
                            if (!isAuthenticated) {
                                console.log('‚ùå Direct access authentication failed, redirecting to login');
                                handleUnauthorizedAccess('Direct access authentication failed');
                            }
                        }
                    }, 1000); // Small delay to ensure SupabaseService is loaded
                }
            });
        </script>
        
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src="script.js"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Check if we're on localhost
        const isLocalhost = window.location.hostname === 'localhost' || 
                           window.location.hostname === '127.0.0.1' || 
                           window.location.hostname === '0.0.0.0';
        
        console.log('üåê Current location:', window.location.href);
        console.log('üîß Protocol:', window.location.protocol);
        console.log('üè† Hostname:', window.location.hostname);
        console.log('üìÅ Pathname:', window.location.pathname);
        console.log('üè† Is localhost:', isLocalhost);
        
        // Only register service worker if not on localhost (to avoid conflicts)
        if ('serviceWorker' in navigator && !isLocalhost) {
            window.addEventListener('load', () => {
                // Try to unregister any existing service workers first
                navigator.serviceWorker.getRegistrations().then(function(registrations) {
                    for(let registration of registrations) {
                        registration.unregister();
                        console.log('Unregistered existing SW:', registration);
                    }
                    
                    // Now register the new one
                    return navigator.serviceWorker.register('./sw.js');
                }).then((registration) => {
                    console.log('‚úÖ Service Worker registered successfully:', registration);
                }).catch((registrationError) => {
                    console.log('‚ùå Service Worker registration failed:', registrationError);
                });
            });
        } else if (isLocalhost) {
            console.log('üö´ Service Worker disabled on localhost to avoid conflicts');
            console.log('üí° Use file:// protocol or deploy to a real server for PWA features');
        } else {
            console.log('‚ùå Service Worker not supported in this browser');
        }
        
        // Check if app is installed
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('üì± Install prompt ready');
        });
        
        // Handle app installation
        window.addEventListener('appinstalled', () => {
            console.log('‚úÖ PWA was installed');
            deferredPrompt = null;
        });
    </script>
        

    </div> <!-- Close mainContent div -->
</body>
</html>
